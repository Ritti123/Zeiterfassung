

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Zeiterfassung</title>
  <style>
    :root {
      --primary-color: #4285f4;
      --secondary-color: #34a853;
      --danger-color: #ea4335;
      --text-color: #333;
      --border-color: #ddd;
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      padding: 10px; 
      max-width: 600px; 
      margin: auto; 
      color: var(--text-color);
      line-height: 1.5;
    }
    
    h2, h3 {
      color: var(--primary-color);
      margin-top: 0;
    }
    
    input, select, button { 
      width: 100%; 
      padding: 12px; 
      margin: 8px 0; 
      font-size: 16px; 
      box-sizing: border-box; 
      border: 1px solid var(--border-color);
      border-radius: 8px;
      -webkit-appearance: none;
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    button.danger {
      background-color: var(--danger-color);
    }
    
    button.secondary {
      background-color: var(--secondary-color);
    }
    
    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px; 
      font-size: 14px;
    }
    
    th, td { 
      border: 1px solid var(--border-color); 
      padding: 8px; 
      text-align: center; 
    }
    
    thead { 
      background: #f5f5f5; 
      font-weight: bold;
    }
    
    tfoot { 
      background: #f8f8f8; 
      font-weight: bold; 
    }
    
    .small-btn { 
      padding: 6px 10px; 
      font-size: 12px; 
      border-radius: 4px;
    }
    
    #month-nav { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin: 15px 0; 
      gap: 10px; 
    }
    
    #current-month { 
      flex: 1; 
      text-align: center; 
      font-weight: bold; 
      font-size: 18px;
    }
    
    #user-section { 
      border: 1px solid var(--border-color); 
      padding: 15px; 
      margin-bottom: 20px; 
      border-radius: 10px;
    }
    
    .reset-pin { 
      display: flex; 
      gap: 8px; 
      margin-top: 10px; 
      align-items: center; 
    }
    
    .reset-pin input { 
      flex: 1; 
    }
    
    .backup-section { 
      margin-top: 25px; 
      border-top: 1px solid var(--border-color); 
      padding-top: 15px; 
    }
    
    .backup-buttons { 
      display: flex; 
      flex-direction: column;
      gap: 10px; 
      margin-top: 15px; 
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      
      input, select, button {
        padding: 10px;
        font-size: 14px;
      }
      
      table {
        font-size: 12px;
      }
    }
    
    /* iPhone Optimierungen */
    @supports (-webkit-touch-callout: none) {
      input, select, button {
        min-height: 44px;
      }
      
      select {
        padding: 12px 15px;
      }
    }
  </style>
</head>
<body>

<div id="user-section">
  <h2>Benutzerverwaltung</h2>
  <div id="user-login">
    <div class="form-group">
      <label for="user-select">Benutzer auswählen:</label>
      <select id="user-select">
        <option value="">-- Bitte auswählen --</option>
      </select>
    </div>
    <div class="form-group">
      <label for="user-pin">PIN eingeben:</label>
      <input type="password" id="user-pin" placeholder="4-stelliger PIN" maxlength="4" inputmode="numeric" />
    </div>
    <button onclick="login()">Anmelden</button>
  </div>
  
  <h3 style="margin-top: 20px;">Benutzer erstellen/löschen</h3>
  <div id="user-manage">
    <div class="form-group">
      <label for="new-user-name">Neuer Benutzername:</label>
      <input type="text" id="new-user-name" placeholder="Name eingeben" />
    </div>
    <div class="form-group">
      <label for="new-user-pin">Neue PIN (4-stellig):</label>
      <input type="password" id="new-user-pin" placeholder="PIN eingeben" maxlength="4" inputmode="numeric" />
    </div>
    <button onclick="createUser()">Benutzer anlegen</button>
    <button class="danger" onclick="deleteUser()">Benutzer löschen</button>
    <div id="reset-area" style="margin-top: 15px;"></div>
  </div>
</div>

<div id="app" style="display:none">
  <!-- App-Inhalt bleibt gleich -->
</div>

<script>
// Dateninitialisierung
let eintraege = JSON.parse(localStorage.getItem('eintraege')) || [];
let users = JSON.parse(localStorage.getItem('users')) || [];
let currentUser = null;
let urlaubstage = 24;
let sollStunden = 8;
let viewDate = new Date();

// Beim Laden der Seite
document.addEventListener('DOMContentLoaded', function() {
  loadData();
  renderUserSelect();
  renderResetList();
  
  // Heutiges Datum als Standard setzen
  const today = new Date();
  document.getElementById('datum').valueAsDate = today;
});

function loadData() {
  try {
    const savedEintraege = localStorage.getItem('eintraege');
    const savedUsers = localStorage.getItem('users');
    
    if (savedEintraege) eintraege = JSON.parse(savedEintraege);
    if (savedUsers) users = JSON.parse(savedUsers);
  } catch (e) {
    console.error("Fehler beim Laden der Daten:", e);
    alert("Fehler beim Laden der gespeicherten Daten");
  }
}

function saveData() {
  try {
    localStorage.setItem('eintraege', JSON.stringify(eintraege));
    localStorage.setItem('users', JSON.stringify(users));
  } catch (e) {
    console.error("Fehler beim Speichern:", e);
    alert("Fehler beim Speichern der Daten");
  }
}

function login() {
  const name = document.getElementById('user-select').value;
  const pin = document.getElementById('user-pin').value.trim();
  
  if (!name) {
    alert("Bitte einen Benutzer auswählen");
    return;
  }
  
  if (pin.length !== 4 || !/^\d+$/.test(pin)) {
    alert("Bitte einen 4-stelligen Zahlen-PIN eingeben");
    return;
  }
  
  const user = users.find(u => u.name === name);
  
  if (!user) {
    alert("Benutzer nicht gefunden");
    return;
  }
  
  if (user.pin !== pin) {
    alert("Falscher PIN");
    return;
  }
  
  currentUser = user.name;
  document.getElementById('app').style.display = 'block';
  document.getElementById('user-section').style.display = 'none';
  document.getElementById('user-pin').value = '';
  renderTabelle();
}

function createUser() {
  const name = document.getElementById('new-user-name').value.trim();
  const pin = document.getElementById('new-user-pin').value.trim();
  
  if (!name) {
    alert("Bitte geben Sie einen Namen ein");
    return;
  }
  
  if (pin.length !== 4 || !/^\d+$/.test(pin)) {
    alert("Bitte einen 4-stelligen Zahlen-PIN eingeben");
    return;
  }
  
  if (users.some(u => u.name.toLowerCase() === name.toLowerCase())) {
    alert("Benutzername existiert bereits");
    return;
  }
  
  const newUser = { name, pin };
  users.push(newUser);
  saveData();
  
  // Formular leeren und Select aktualisieren
  document.getElementById('new-user-name').value = '';
  document.getElementById('new-user-pin').value = '';
  renderUserSelect();
  
  // Neuen Benutzer selektieren
  document.getElementById('user-select').value = name;
  
  alert(`Benutzer "${name}" wurde erfolgreich angelegt`);
}

function renderUserSelect() {
  const select = document.getElementById('user-select');
  const currentValue = select.value;
  
  select.innerHTML = '<option value="">-- Bitte auswählen --</option>' + 
    users.map(u => `<option value="${u.name}">${u.name}</option>`).join('');
  
  if (currentValue && users.some(u => u.name === currentValue)) {
    select.value = currentValue;
  }
}

// Rest der Funktionen bleibt gleich wie im vorherigen Code...

// Initialisierung
function init() {
  loadData();
  renderUserSelect();
  renderResetList();
  
  // Heutiges Datum als Standard setzen
  const today = new Date();
  document.getElementById('datum').valueAsDate = today;
}

init();
</script>
</body>
</html>
