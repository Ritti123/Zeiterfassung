<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zeiterfassung</title>
  <style>
    :root {
      --blue: #3498db;
      --green: #2ecc71;
      --red: #e74c3c;
      --gray: #f4f4f4;
      --font: "Segoe UI", Roboto, Arial, sans-serif;
    }
    body {
      font-family: var(--font);
      margin: 0;
      padding: 10px;
      background: white;
      color: #333;
      max-width: 600px;
      margin: auto;
    }
    h2, h3, h4 {
      margin-top: 1.2em;
      margin-bottom: 0.5em;
    }
    .section {
      background: var(--gray);
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 16px;
    }
    button {
      background-color: var(--blue);
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button.secondary {
      background-color: var(--green);
    }
    button.delete {
      background-color: var(--red);
      font-size: 14px;
      padding: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th {
      background: #eee;
    }
    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .stat-box {
      flex: 1;
      min-width: 130px;
      background: white;
      border: 1px solid #ccc;
      padding: 8px;
      border-radius: 6px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="section">
    <h2>Einstellungen</h2>
    <label>Sollstunden pro Tag:</label>
    <input type="number" id="config-workhours" min="1" max="24">
    <label>Urlaubsanspruch (Tage/Jahr):</label>
    <input type="number" id="config-vacation" min="1" max="60">
    <button id="save-settings-btn" class="secondary">Einstellungen speichern</button>
  </div>

  <div class="section">
    <h2>Zeiterfassung</h2>
    <input type="date" id="date">
    <input type="time" id="start-time" placeholder="Startzeit">
    <input type="time" id="end-time" placeholder="Endzeit">
    <input type="number" id="break" value="30" placeholder="Pause in Minuten">
    <select id="type">
      <option value="Arbeit">Arbeit</option>
      <option value="Urlaub">Urlaub</option>
      <option value="Krank">Krank</option>
      <option value="Feiertag">Feiertag</option>
    </select>
    <button id="add-entry-btn">Eintrag hinzufügen</button>

    <label for="month">Monat anzeigen:</label>
    <input type="month" id="month">

    <h3>Einträge</h3>
    <table>
      <thead>
        <tr>
          <th>Datum</th><th>Start</th><th>Ende</th><th>Pause</th><th>Art</th><th>Stunden</th><th>Aktion</th>
        </tr>
      </thead>
      <tbody id="time-entries"></tbody>
    </table>

    <div class="stats">
      <div class="stat-box"><h4>Überstunden</h4><p id="overtime">0h 0min</p></div>
      <div class="stat-box"><h4>Urlaub</h4><p id="vacation-days">0 Tage</p></div>
      <div class="stat-box"><h4>Krank</h4><p id="sick-days">0 Tage</p></div>
    </div>

    <button id="export-csv-btn" class="secondary">Monatsreport (CSV)</button>
    <button id="export-backup-btn" class="secondary">Daten sichern</button>
    <button id="import-backup-btn">Daten laden</button>
    <input type="file" id="import-file" style="display:none">
  </div>

  <script>
    let settings = JSON.parse(localStorage.getItem('settings') || '{"workHoursPerDay":8,"vacationDaysPerYear":24}');
    let timeEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');

    const $ = id => document.getElementById(id);
    const tbody = $('time-entries');

    document.addEventListener('DOMContentLoaded', () => {
      $('date').valueAsDate = new Date();
      const now = new Date();
      $('month').value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}`;
      $('config-workhours').value = settings.workHoursPerDay;
      $('config-vacation').value = settings.vacationDaysPerYear;
      loadEntries();
    });

    $('save-settings-btn').onclick = () => {
      settings.workHoursPerDay = parseInt($('config-workhours').value) || 8;
      settings.vacationDaysPerYear = parseInt($('config-vacation').value) || 24;
      localStorage.setItem('settings', JSON.stringify(settings));
      alert('Einstellungen gespeichert.');
      loadEntries();
    };

    $('add-entry-btn').onclick = () => {
      const date = $('date').value;
      const start = $('start-time').value;
      const end = $('end-time').value;
      const pause = parseInt($('break').value) || 0;
      const type = $('type').value;

      if (!date || (type === 'Arbeit' && (!start || !end))) return alert('Bitte alle Felder ausfüllen.');

      let hours = 0;
      if (type === 'Arbeit') {
        const startMin = new Date(`${date}T${start}`).getTime() / 60000;
        const endMin = new Date(`${date}T${end}`).getTime() / 60000;
        if (endMin <= startMin) return alert('Endzeit muss nach Startzeit liegen.');
        hours = ((endMin - startMin - pause) / 60).toFixed(2);
      }

      timeEntries.push({ date, start, end, pause, type, hours });
      localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
      $('start-time').value = '';
      $('end-time').value = '';
      $('date').valueAsDate = new Date(new Date(date).getTime() + 86400000);
      loadEntries();
    };

    $('month').onchange = loadEntries;

    function loadEntries() {
      tbody.innerHTML = '';
      let overtimeMin = 0, vacation = 0, sick = 0;
      const month = $('month').value;
      const rows = timeEntries.filter(e => e.date.startsWith(month)).sort((a, b) => a.date.localeCompare(b.date));

      rows.forEach(entry => {
        const tr = tbody.insertRow();
        tr.innerHTML = `
          <td>${formatDate(entry.date)}</td>
          <td>${entry.start || '-'}</td>
          <td>${entry.end || '-'}</td>
          <td>${entry.pause || 0}</td>
          <td>${entry.type}</td>
          <td>${entry.hours || '0'}</td>
          <td><button class="delete">Löschen</button></td>`;
        tr.querySelector('button').onclick = () => {
          timeEntries.splice(timeEntries.indexOf(entry), 1);
          localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
          loadEntries();
        };

        if (entry.type === 'Arbeit') {
          const mins = parseFloat(entry.hours) * 60;
          overtimeMin += mins - settings.workHoursPerDay * 60;
        } else if (entry.type === 'Urlaub') vacation++;
        else if (entry.type === 'Krank') sick++;
      });

      $('overtime').textContent = formatMinutes(overtimeMin);
      $('vacation-days').textContent = `${vacation} Tage`;
      $('sick-days').textContent = `${sick} Tage`;
    }

    function formatDate(d) {
      const [y,m,day] = d.split('-');
      return `${day}.${m}.${y}`;
    }

    function formatMinutes(mins) {
      const h = Math.floor(mins / 60);
      const m = Math.round(mins % 60);
      return `${h}h ${m}min`;
    }

    $('export-csv-btn').onclick = () => {
      const month = $('month').value;
      const rows = timeEntries.filter(e => e.date.startsWith(month));
      if (!rows.length) return alert('Keine Daten vorhanden.');

      let csv = 'Datum;Start;Ende;Pause;Art;Stunden\n';
      let overtimeMin = 0, vacation = 0, sick = 0;

      rows.forEach(e => {
        csv += `${formatDate(e.date)};${e.start || ''};${e.end || ''};${e.pause};${e.type};${e.hours}\n`;
        if (e.type === 'Arbeit') overtimeMin += parseFloat(e.hours) * 60 - settings.workHoursPerDay * 60;
        else if (e.type === 'Urlaub') vacation++;
        else if (e.type === 'Krank') sick++;
      });

      csv += `\nÜberstunden:;${formatMinutes(overtimeMin)}\n`;
      csv += `Urlaubstage:;${vacation}\n`;
      csv += `Krankheitstage:;${sick}\n`;
      download('monatsreport.csv', csv, 'text/csv');
    };

    $('export-backup-btn').onclick = () => {
      const data = { entries: timeEntries, exported: new Date().toISOString() };
      download('backup_zeiterfassung.json', JSON.stringify(data, null, 2), 'application/json');
    };

    $('import-backup-btn').onclick = () => $('import-file').click();
    $('import-file').onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          if (!Array.isArray(data.entries)) throw new Error('Ungültiges Format.');
          if (confirm(`${data.entries.length} Einträge importieren? Vorherige Daten werden überschrieben.`)) {
            timeEntries = data.entries;
            localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
            loadEntries();
            alert('Import erfolgreich.');
          }
        } catch (err) {
          alert('Fehler: ' + err.message);
        }
      };
      reader.readAsText(file);
    };

    function download(filename, content, type) {
      const blob = new Blob(["\uFEFF" + content], { type });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
      URL.revokeObjectURL(link.href);
    }
  </script>
</body>
</html>
     
    
